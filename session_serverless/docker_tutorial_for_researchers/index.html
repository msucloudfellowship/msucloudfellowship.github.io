
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.4">
    
    
      
        <title>Docker Tutorial for Researchers featuring Jupyter Lab - MSU Cloud Computing Fellowship</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.bd3936ea.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#docker-tutorial-for-researchers-featuring-jupyter-lab" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="MSU Cloud Computing Fellowship" class="md-header__button md-logo" aria-label="MSU Cloud Computing Fellowship" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MSU Cloud Computing Fellowship
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Docker Tutorial for Researchers featuring Jupyter Lab
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="MSU Cloud Computing Fellowship" class="md-nav__button md-logo" aria-label="MSU Cloud Computing Fellowship" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    MSU Cloud Computing Fellowship
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../contact/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contact
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Sessions
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Sessions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../session_introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    · Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../session_how_to_cloud/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    · How does the cloud work?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../session_cloud_storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    · Cloud Storage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../session_datasystems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    · Data Systems
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../session_bigdata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    · Big Data and the cloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    · Serverless, Containers, and FaaS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../session_organization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    · Cloud Services Organization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../miniproject/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    · Mini-Project
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../projects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About Fellowship Projects
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../references/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../cloud_glossary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud Glossary
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../index2021/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Previous 21-22 syllabus
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
    <nav class="md-nav" aria-label="Introduction">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requirements-to-follow-along" class="md-nav__link">
    requirements to follow along
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#part-1-using-docker-on-your-computer" class="md-nav__link">
    Part 1. Using Docker on your computer
  </a>
  
    <nav class="md-nav" aria-label="Part 1. Using Docker on your computer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-1-install-docker" class="md-nav__link">
    step 1: install Docker
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#step-2-findselect-an-image-to-run-from-the-internet" class="md-nav__link">
    Step 2. Find/Select an image to run from the Internet
  </a>
  
    <nav class="md-nav" aria-label="Step 2. Find/Select an image to run from the Internet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#step-3-download-and-run-the-image-as-a-container-using-the-command-line" class="md-nav__link">
    Step 3. Download and run the image as a container using the command line
  </a>
  
    <nav class="md-nav" aria-label="Step 3. Download and run the image as a container using the command line">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#command-breakdown-for-docker-run" class="md-nav__link">
    Command breakdown for "docker run":
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#working-with-containers" class="md-nav__link">
    Working with Containers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#step-4-connecting-docker-to-your-local-files" class="md-nav__link">
    Step 4. Connecting docker to your local files
  </a>
  
    <nav class="md-nav" aria-label="Step 4. Connecting docker to your local files">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#volumes-step-1-create-the-folder" class="md-nav__link">
    Volumes step 1. Create the folder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volumes-step-2-give-docker-permission-to-use-the-folder" class="md-nav__link">
    Volumes step 2. Give Docker permission to use the folder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#volumes-step-3-add-volume-when-running-the-container" class="md-nav__link">
    Volumes step 3.  Add volume when running the container
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="docker-tutorial-for-researchers-featuring-jupyter-lab">Docker Tutorial for Researchers featuring Jupyter Lab</h1>
<p><strong>for the 2022 MSU Cloud Computing Fellowship Session 6: <a href="../">Serverless, Containers, and FaaS</a></strong></p>
<h2 id="introduction">Introduction</h2>
<p>This is a walkthrough for using Docker containers on your desktop and in the cloud using Microsoft Azure.  </p>
<p>See the main page for this session and also the <a href="docs/session_serverless/linux_containers_and_the_cloud.md">introduction to containers</a> along with other links for background information. </p>
<h3 id="requirements-to-follow-along">requirements to follow along</h3>
<ul>
<li>azure account</li>
<li>updated Azure command line utlities installed (az cli)</li>
<li>logged into to Azure using <code>az login</code></li>
<li>examples depend on the Jupyter lab stack being available in Dockerhub (valid November 2022)</li>
</ul>
<p>Notes: </p>
<p>Docker is not the only system for using containers, but it's the most popular and I won't cover the others.  I mention this because the main documentation for the container we will be using (Jupyter stack) describes using 'Podman' but we will stick with Docker for now.   </p>
<p>A reminder that Docker is a company that hosts a service to upload/download container images, and the name of the softwae ('docker') that can run containers and the name of a file ('Dockerfile' ) to create containers.    </p>
<p>Windows users: Docker was created for Linux but Microsoft has worked hard to make it viable for Windows users as well.   The primary examples in this tutorial for for the command line will be for Mac/Linux, but there should be an equivalent option for Windows users.   One way to make your windows computer more like Linux is to install the Windows Subsystem for Linux (WSL) which would provide you with a Terminal program that runs the "bash" shell
There are three parts to this tutorial: </p>
<ol>
<li>working with containers on your computer (this document)</li>
<li>Launching containers on Azure ( in development )</li>
<li>Creating your own containers ( in development )</li>
</ol>
<p>Let's get started.</p>
<h2 id="part-1-using-docker-on-your-computer">Part 1. Using Docker on your computer</h2>
<h3 id="step-1-install-docker">step 1: install Docker</h3>
<p>Docker offers many products, some of which are underlying tools to use docker.   You minimally need the "Docker Engine" to run and manage docker containers via the command line (only).   However they also offer "Docker Desktop": a GUI to work with images and containers, connect and download from Dockerhub, set preferences, and includes all the other tools they make (Docker Compose, etc).   </p>
<p>Hence we will install Docker Desktop to get everything but this tutorial will primarily work with Docker via command line interface.   Most software that is based on docker will have instructions for running it using the command line.  </p>
<p>Install docker desktop using instructions here: <a href="https://docs.docker.com/desktop/">https://docs.docker.com/desktop/</a></p>
<p>Windows users: Microsoft has provided some good information on their site for using docker with the WSL, but you must install that first : <a href="https://learn.microsoft.com/en-us/windows/wsl/install">https://learn.microsoft.com/en-us/windows/wsl/install</a> then see  <a href="https://learn.microsoft.com/en-us/windows/wsl/tutorials/wsl-containers">https://learn.microsoft.com/en-us/windows/wsl/tutorials/wsl-containers</a></p>
<p>Note that Docker Desktop works differently on Mac and Windows.  I recommend that you take some time to review the introduction from Docker desktop.  Minimally, we want to open the "dashboard" and to that you find the docker icon <img alt="docker whale" src="https://docs.docker.com/assets/images/whale-x.svg" /> in the system tray on windows, and menu bar on Mac, and select "dashboard" .  This may be helpful: <a href="https://docs.docker.com/desktop/use-desktop/#the-docker-menu">https://docs.docker.com/desktop/use-desktop/#the-docker-menu</a> </p>
<h2 id="step-2-findselect-an-image-to-run-from-the-internet">Step 2. Find/Select an image to run from the Internet</h2>
<p>Many programs and servers have a "dockerized" version of software someone has prepared, often linked on the software  web page or in a a README file, and you could use almost anything with this tutorial.  However for this tutorial we'll be running JupyterLab to use python notebooks on our laptop.    </p>
<p>The Jupyter Stacks project offers many different containers with different amounts of software installed (or 'stacked') along with Jupyter lab.  The important section is  <a href="https://jupyter-docker-stacks.readthedocs.io/en/latest/using/selecting.html#core-stacks">https://jupyter-docker-stacks.readthedocs.io/en/latest/using/selecting.html#core-stacks</a> describing each of their offerings.    </p>
<p>I will install "datascience-notebook"  using instructions similar but not exactly the same as theirs.    R users could follow along using instructions from <a href="https://rocker-project.org/">the "Rocker" project</a></p>
<p>Containers when published are minimally named as follows (this is the URI for the container):</p>
<p><code>registryaddress/author/imagename:tag</code></p>
<ul>
<li>Author can be a person or an organization</li>
<li>Imagename is what the author named the container image</li>
<li>tag is like a version, but is not limited to version (but is limited in size).   Example tags could be 'v3' and the latest version is 'latest' by convention.   </li>
<li>Registry address is usually not needed because we are always using Dockerhuib.   However The full name of container we pull from Dockerhub (99% are hosted on Dockerhub) includes the docker address, or </li>
</ul>
<p><code>docker.io/author/imagename:tag</code>   but the docker software automatically puts docker.io when needed</p>
<h3 id="step-3-download-and-run-the-image-as-a-container-using-the-command-line">Step 3. Download and run the image as a container using the command line</h3>
<p>In your terminal or cmd.exe program, use this command: </p>
<div class="highlight"><pre><span></span><code><span class="w"> </span>docker<span class="w"> </span>run<span class="w"> </span>-p<span class="w"> </span><span class="m">8888</span>:8888<span class="w">  </span>--name<span class="w"> </span>jupyter-datascience<span class="w"> </span>jupyter/datascience-notebook:latest
</code></pre></div>
<p>You can do something similar in the desktop dashboard, but only if you log-in to a repository like DockerHub.  So for this tutorial we'll be using the command line.   See <a href="https://docs.docker.com/desktop/use-desktop/images/">https://docs.docker.com/desktop/use-desktop/images/</a> for more on the desktop interface for using Images.  </p>
<h4 id="command-breakdown-for-docker-run">Command breakdown for "docker run":</h4>
<ul>
<li><strong>docker</strong> - main program to work with images/containers</li>
<li><strong>run</strong> - command to docker.  others include 'pull' to get image. this command will automatically pull the image from dockerhub first if you don't have it on your computer </li>
<li><strong>-p = port</strong> if the image runs a server, all servers need a 'port' to listen on, and you have to tell docker which port on your own computer you want to connect to the container. Note we could have used any port ( &gt; 1024) but using the same port makes it easy to remember.  See this doc for <a href="https://www.cloudflare.com/learning/network-layer/what-is-a-computer-port/">descriptions of ports</a>.  The important thing is anything over &gt;1024 is fair game to use, but software tends to have a port they use by convention.   Jupyter lab uses 8888.   Rstudio uses 8787. and Postgresql uses 5432,  just because.</li>
<li><strong>name</strong> this is optional and you can use whatever name you need to help organize your containers.  If you don't provide it, Docker will assign a random name.  when you have several images/containers running for a complex system or as you develop new containers, assigning names willhelp you keep track.     </li>
</ul>
<p>If all goes well you will see download progress, and then part of the log or command output: </p>
<div class="highlight"><pre><span></span><code><span class="o">[</span>I<span class="w"> </span><span class="m">2022</span>-11-11<span class="w"> </span><span class="m">04</span>:59:32.704<span class="w"> </span>ServerApp<span class="o">]</span><span class="w"> </span>Jupyter<span class="w"> </span>Server<span class="w"> </span><span class="m">1</span>.23.0<span class="w"> </span>is<span class="w"> </span>running<span class="w"> </span>at:
<span class="o">[</span>I<span class="w"> </span><span class="m">2022</span>-11-11<span class="w"> </span><span class="m">04</span>:59:32.704<span class="w"> </span>ServerApp<span class="o">]</span><span class="w"> </span>http://801ec4713575:8888/lab?token<span class="o">=</span>57fb181bc074c193095db3df8c245521d3acb83530078d73
<span class="o">[</span>I<span class="w"> </span><span class="m">2022</span>-11-11<span class="w"> </span><span class="m">04</span>:59:32.705<span class="w"> </span>ServerApp<span class="o">]</span><span class="w">  </span>or<span class="w"> </span>http://127.0.0.1:8888/lab?token<span class="o">=</span>57fb181bc074c193095db3df8c245521d3acb83530078d73
<span class="o">[</span>I<span class="w"> </span><span class="m">2022</span>-11-11<span class="w"> </span><span class="m">04</span>:59:32.705<span class="w"> </span>ServerApp<span class="o">]</span><span class="w"> </span>Use<span class="w"> </span>Control-C<span class="w"> </span>to<span class="w"> </span>stop<span class="w"> </span>this<span class="w"> </span>server<span class="w"> </span>and<span class="w"> </span>shut<span class="w"> </span>down<span class="w"> </span>all<span class="w"> </span>kernels<span class="w"> </span><span class="o">(</span>twice<span class="w"> </span>to<span class="w"> </span>skip<span class="w"> </span>confirmation<span class="o">)</span>.
<span class="o">[</span>C<span class="w"> </span><span class="m">2022</span>-11-11<span class="w"> </span><span class="m">04</span>:59:32.707<span class="w"> </span>ServerApp<span class="o">]</span>

<span class="w">    </span>To<span class="w"> </span>access<span class="w"> </span>the<span class="w"> </span>server,<span class="w"> </span>open<span class="w"> </span>this<span class="w"> </span>file<span class="w"> </span><span class="k">in</span><span class="w"> </span>a<span class="w"> </span>browser:
<span class="w">        </span>file:///home/jovyan/.local/share/jupyter/runtime/jpserver-6-open.html
<span class="w">    </span>Or<span class="w"> </span>copy<span class="w"> </span>and<span class="w"> </span>paste<span class="w"> </span>one<span class="w"> </span>of<span class="w"> </span>these<span class="w"> </span>URLs:
<span class="w">        </span>http://801ec4713575:8888/lab?token<span class="o">=</span>57fb181bc074c193095db3df8c245521d3acb83530078d73
<span class="w">     </span>or<span class="w"> </span>http://127.0.0.1:8888/lab?token<span class="o">=</span>57fb181bc074c193095db3df8c245521d3acb83530078d73
</code></pre></div>
<p>When Jupyter Lab runs, it outputs messages, and Docker is simply forwarding those message to the "log" of output, which when you run on your computer shows up in your terminal.    You can also view the log in the Docker desktop user interface. </p>
<p>To open Jupyter lab, use the last URl in the list.  </p>
<p>Note about ports:  These Jupyter lab docker images are set to run on port 8888 and will always report that.  However, if you use a different port in the command, then that is the one  you want to use.   For example the command 
<code>docker run -p 9999:8888 jupyter/datascience-notebook:latest</code> the URL would be <code>http://127.0.0.1:9999/... etc</code> but the log message will still say 8888 becuase that's the port used by the container internally - it doesn't know about the external port map.    The moral is to try to use the same port to reduce confusion.  </p>
<p>When you run the jupyter notebook, you may see a page asking for a token.  Follow the instructions on the page to proceed.</p>
<p>If it worked and you can log in, you can create a notebook, do some python (or R or Julia) and save the notebook.  Great!  But when you save, where does it go?  Right now, everything is stored inside the container.   If you shut down the container, that is all lost, because internal container storage is ephemeral.   </p>
<p>In the same terminal you ran the command, use Ctrl+C to cancel it and stop running.   You can also use the Docker desktop GUI to start and stop containers.  </p>
<p>Note if you run this again, you'll get the error</p>
<div class="highlight"><pre><span></span><code>docker: Error response from daemon: Conflict. The container name &quot;jupyter-datascience&quot; is already in use by container &quot;...&quot;. You have to remove (or rename) that container to be able to reuse that name.
</code></pre></div>
<h4 id="working-with-containers">Working with Containers</h4>
<p>After creating a container and stopping it, you can do a couple of things: re-start the container, delete it, start a second instance of the image in a new container, or list all your containers.  Note these containers are distinct from the images from which they are made.   </p>
<p><strong>Using the docker desktop user interface</strong></p>
<p>You can accomplish all of the activities below using the "Dashboard" section of the Docker desktop user interface, which lists all of the containers on your system along with any images you've downloaded.   See <a href="https://docs.docker.com/desktop/use-desktop/">https://docs.docker.com/desktop/use-desktop/</a> for an introduction.  </p>
<p><strong>Using docker command line to manage containers</strong></p>
<ol>
<li>re-run the container - it's still good!  It's just paused.  </li>
</ol>
<p><code>docker container restart jupyter-datascience</code></p>
<p>Note you use the name you assigned the container when you ran it, not the name of the "image"</p>
<ol>
<li>delete the container </li>
</ol>
<p><code>docker container rm jupyter-datascience</code></p>
<p>You can run now a new one (perhaps to alter the port, or other options).  The syntax is based on the Linux 'rm' command </p>
<ol>
<li>start a different container from the same image</li>
</ol>
<p><code>docker run -p 8889:8888  --name jupyter-datascience2  jupyter/datascience-notebook:latest</code></p>
<p>In this example I used a different port number, which would allow you to run <em>both</em> containers at the same.  I don't think, for this image, there is a reason to do that, but it's possible.<br />
`
4. And many others...</p>
<p><a href="https://docs.docker.com/engine/reference/commandline/container/">https://docs.docker.com/engine/reference/commandline/container/</a></p>
<p>For example list all the containers on the system <code>docker container ls -a</code></p>
<h3 id="step-4-connecting-docker-to-your-local-files">Step 4. Connecting docker to your local files</h3>
<p>Containers are great because they are unchanging environments you can run repeatedly.  They are not great because they are unchanging environments and anything you 'save' or change is lost when you shut down or delete the container.   Computing is not very valuable unless you can save your output.   Docker containers are walled off from your computer unless you explicitly connect a folder from your disk to a folder location in the container.    There are two ways to do this but we are using "volumes" (see docker Volumne documentation for details).  </p>
<p>The goal is to take a folder on your computer and tell Docker to make it look like it's a sub folder somewhere in the container.  The folder on your computer is up to you, but the location in the docker image is very dependent on the structure and nature of the container.    Some have strict requirments.   </p>
<p>Steps to use volumes on your computer </p>
<ol>
<li>create the folder</li>
<li>use Docker desktop to give permission to use the folder</li>
<li>run the container with the command to 'mount' the folder into the Linux container</li>
</ol>
<h4 id="volumes-step-1-create-the-folder"><strong>Volumes step 1. Create the folder</strong></h4>
<p>let's create a folder on your comptuer.  You can use wahatever you want, and this is just an example. </p>
<p>Create folder a folder called "notebooks" in your Documents folder.  You can put it anywhere but for this tutorial we will assume the notebooks folder to be used with docker will be in the following location</p>
<ul>
<li>Mac: <code>/Users/&lt;username&gt;/Documents/notebooks.</code></li>
<li>Windows: <code>C:\users\&lt;userid&gt;\Documents\notebooks</code>   </li>
</ul>
<h4 id="volumes-step-2-give-docker-permission-to-use-the-folder"><strong>Volumes step 2. Give Docker permission to use the folder</strong></h4>
<p>To prevent your system from being deleted by roque containers, Docker requires you to grant it permission to use a folder in a container.   There is a way to edit the configuration file for Docker to allow access to folders on your computer, but here we'll use the Docker Desktop GUI app.  </p>
<p>Open the Docker Desktop Dashboard, and then open preferences (gear icon in top right of Dashboard). Inside preference, open the "resources" section.  Inside that is an "advanced" sub-menu; select "file sharing" that list folders Docker can access.  Click the blue "(+)" icon on the bottom right to add the "notebooks" folder you just created in Documents.  </p>
<p>The Jupyter stack containers have a long discussion on this in the documentation, but in short, there is a special user account inside the container, and to see notebooks yuo have to create a subfolder in that account's home directory.  The user is named "jovyan" and so the home directory inside the container is "/home/jovyan" and that's where the notebooks are looked for. </p>
<h4 id="volumes-step-3-add-volume-when-running-the-container"><strong>Volumes step 3.  Add volume when running the container</strong></h4>
<p>To add a volume to the Jupyter stack containers, you add a command parameter with a pair of folders: the one on your computer and the path thats used in the container : </p>
<p><code>-v /path/on/your/computer:/path/inside/container</code></p>
<p>On your computer it makes sense, but what about the container side of the ":" ?  I know from the  Jupyter Stacks documentation that this image uses the folder <code>/home/jovyan/</code> so we add "notebooks" to this path and Docker connects the folder 'notebooks' on our computer to folder 'notebooks' to inside the the container.</p>
<p>**Mac/Linux:  **</p>
<p>You cam use mac environment variables to reference your home directory.  </p>
<p>Given a  'notebooks' folder in Documents folder, the command would be </p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-p<span class="w"> </span><span class="m">8888</span>:8888<span class="w"> </span>-v<span class="w"> </span><span class="nv">$HOME</span>/Documents/notebooks:/home/jovyan/notebooks<span class="w">  </span>jupyter/datascience-notebook:latest
</code></pre></div>
<p><strong>On Windows</strong> is similar but we could not bet the environment variable to work, so you'll have to put in your user name:</p>
<div class="highlight"><pre><span></span><code>docker<span class="w"> </span>run<span class="w"> </span>-p<span class="w"> </span><span class="m">8888</span>:8888<span class="w"> </span>-v<span class="w"> </span>c:<span class="se">\\</span>users<span class="se">\\</span>&lt;your<span class="w"> </span>user<span class="w"> </span>id&gt;<span class="se">\\</span>Documents<span class="se">\\</span>notebooks:/home/jovyan/notebooks<span class="w">  </span>jupyter/datascience-notebook:latest
</code></pre></div>
<p>Now when you open the browser and copy/paste the URL for the new notebook server you've started (with the token), you'll see the "notebooks" folder on the left side, and any notebook you save there can be found on your computer.    </p>
<p>note that there are aother potentially more sophisticated ways of using Volumes than this, but this works for us!   see the docker documenttaion for details.  </p>
<hr />
<h1 id="part-2-using-azure-to-run-containers">Part 2: using Azure to run containers</h1>
<p>Azure has several services for running containers or based on containers.  For this example we will work with <a href="https://learn.microsoft.com/en-us/azure/container-instances/container-instances-overview">Azure Container Instances</a>.  (this link is the same as on the main page of the serverless session)</p>
<p>If you have the [Azure command line utility installed] on your computer,  and you know the name of your resource group ( for 2022-23 fellows we use the pattern "ccf22_<netid>".    You can run the Jupyter Lab container with just one command line: </p>
<div class="highlight"><pre><span></span><code>az<span class="w"> </span>container<span class="w"> </span>create<span class="w"> </span>--resource-group<span class="w"> </span><span class="s2">&quot;put your resource group name here&quot;</span><span class="w"> </span>--name<span class="w"> </span>jupyterlab<span class="w"> </span>--image<span class="w"> </span>docker.io/jupyter/datascience-notebook:latest<span class="w"> </span>--dns-name-label<span class="w"> </span><span class="s2">&quot; put a unique name here&quot;</span><span class="w"> </span>--ports<span class="w"> </span><span class="m">8888</span>
</code></pre></div>
<p>Note if you don't want to install the Azure command line (which is not small!) then you can use the <a href="https://learn.microsoft.com/en-us/azure/cloud-shell/overview">Azure Cloud Shell</a></p>
<ul>
<li>
<p>"resource-group" = your group, which you can find with the command <code>az group list</code></p>
</li>
<li>
<p>"name" is the name of the container that could be anything, in the example below I use "jupyterlab" but could also be named for the project you are working on.  It may be useful to add more information about how you ser using it , say "jupyterlab-testing" or add your netid to it.  </p>
</li>
<li>
<p>"dns-name-label" is used to create the URL that you will go to so it has to be unique.  One option is to use your NetID as part of the name, e.g. "jupyterlab-sparty"</p>
</li>
<li>
<p>"image" this is the URL of the image we need to tell Azure which container "registry" to look to, and for Docker that's <code>docker.io</code> The image I used in the command below is the Jupyter stacks data science image, but you could use any image that has a web server, for example </p>
</li>
</ul>
<h3 id="about-this-command">About this command</h3>
<p>Just like the command on your own computer, this maps port 8888 used by the Jupyter server to the same number on the host.   </p>
<p>This once creates the Azure container instance resource in your group,  uploads and configures the docker image, and starts the container.  </p>
<p>the output is a long text in JSON format that has some crucial information in it.   You can always get this information again with the 'show' commands like this</p>
<p><code>az container show -g $RG --name jupyterlab</code></p>
<p>but also from the Azure portal.   The information you need in the output is this: </p>
<div class="highlight"><pre><span></span><code><span class="nt">&quot;ipAddress&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;dnsNameLabel&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jupyterlab-billspat&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;fqdn&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;jupyterlab-billspat.northcentralus.azurecontainer.io&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ip&quot;</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;ports&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">      </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;port&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">8888</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;protocol&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;TCP&quot;</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">],</span>
<span class="w">    </span><span class="nt">&quot;type&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Public&quot;</span>
<span class="w">  </span><span class="p">},</span>
</code></pre></div>
<p>and the FQDN is the fully qualified domain name or web address where the server is running.  Note it starts with the 'dns-name-label' parameter you entered above.   </p>
<p>Put the "FQDN" in a browser, and add <code>:8888</code>    So for me, the URL is  "<a href="http://jupyterlab-billspat.northcentralus.azurecontainer.io:8888">http://jupyterlab-billspat.northcentralus.azurecontainer.io:8888</a>"  - but that's not enough!   You still need the security token!  </p>
<p>The challenge with getting the token is that when running on azure (unlike docker on your computer) you don't see the logs of the running container, and the token is output in the logs.   There are two ways (at least) to get it: </p>
<h4 id="getting-the-docker-container-logs-via-command-line">getting the docker container logs via command line</h4>
<p><code>az container logs --resource-group "your resource group name here" --name "the --name option you used above here"</code></p>
<p>lists all the logs, but we just want the token.  Here is what I run on my mac to filter the logs using <code>grep</code> </p>
<p><code>az container logs --resource-group "ccf22_billspat" --name "jupyterlab-test" | grep token</code></p>
<h4 id="getting-the-docker-container-logs-using-the-azure-portal">getting the docker container logs using the Azure portal:</h4>
<ul>
<li>open portal.azure.com, go to your Resource Group if it's not already open</li>
<li>find the new container instance in the list of resources, then open it up.   </li>
<li>inside that screen, look for the "containers" section on the left side.  Then select the container (mine isa called "jupyterlab-test", select "logs", look in the looks for the token and copy and paste it</li>
</ul>
<h3 id="using-cloud-storage-with-azure-container-instances">Using Cloud Storage with Azure Container instances.</h3>
<p>Recall from the Storage session, when you create an Azure storage container, inside that you can created different types of storage, primarily "blob" or "files."   Files are modeled on network storage, hence easier to connect to running systems directly.   </p>
<p>If you have an Azure File share in one of your Azure Storage containers, you can connect to it </p>
<p>The following doc from Azure describes how to use the Azure CLI and Bash to get the necessary information about file share and connect it to a container instance. 
<a href="https://learn.microsoft.com/en-us/azure/container-instances/container-instances-volume-azure-files">https://learn.microsoft.com/en-us/azure/container-instances/container-instances-volume-azure-files</a></p>
<p>Here is a shortened version based on the Portal</p>
<ol>
<li>
<p>Create a File share if you don't one already: </p>
</li>
<li>
<p>Create or use your existing storage account in the portal </p>
</li>
<li>
<p>Using the Portal open the storage account resource, then go to "File shares" on the left side and create a new file share using the "[+ File share]" button at the top.  It can be named anything you like.   If performance is not crucial, select "hot" tier storage.  </p>
</li>
<li>
<p>Get some security information from the portal  </p>
</li>
</ol>
<p>STORAGE_ACCOUNT_NAME: the main name of the storage account in which you created the File share
SHARE_NAME the name of the file share you  just created (or are using)
STORAGE_KEY this takes the most work to find. 
  - in the Portal, open the storage account main page (not the file share, but the storage account) 
  - on the left side, find "Access Keys"
  - this will list the storage account name, and 2 keys
  - each key list both the key by itself, and a "connection string" useful for other services
  - you can use either key, it doesn't matter.  Use the "show" button to show the key so you can copy/paste it</p>
<ol>
<li>Run the container as before, but now with file share: </li>
</ol>
<p>Note in the command below, I'm using the "line continuation" characther "\" that works for Bash shell and maybe Powershell.  If you are using Windows you may have to adjust the syntax</p>
<p>In the command below, replace the </p>
<div class="highlight"><pre><span></span><code>az<span class="w"> </span>container<span class="w"> </span>create<span class="w"> </span>--resource-group<span class="w"> </span><span class="s2">&quot;put your resource group name here&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--name<span class="w"> </span>jupyterlab<span class="w"> </span>--image<span class="w"> </span>docker.io/jupyter/datascience-notebook:latest<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--dns-name-label<span class="w"> </span><span class="s2">&quot; put a unique name here&quot;</span><span class="w"> </span>--ports<span class="w"> </span><span class="m">8888</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--azure-file-volume-account-name<span class="w"> </span>STORAGE_ACCOUNT_NAME<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--azure-file-volume-share-name<span class="w"> </span>SHARE_NAME<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--azure-file-volume-account-key<span class="w"> </span>STORAGE_KEY<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--azure-file-volume-mount-path<span class="w"> </span>/home/jovyan/notebooks
</code></pre></div>
<p>For example : </p>
<div class="highlight"><pre><span></span><code>az<span class="w"> </span>container<span class="w"> </span>create<span class="w"> </span>--resource-group<span class="w"> </span><span class="s2">&quot;ccf22_billspat&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--name<span class="w"> </span>jupyterlab-test<span class="w"> </span>--image<span class="w"> </span>docker.io/jupyter/datascience-notebook:latest<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--dns-name-label<span class="w"> </span><span class="s2">&quot;jupyterlab-test&quot;</span><span class="w"> </span>--ports<span class="w"> </span><span class="m">8888</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--azure-file-volume-account-name<span class="w"> </span>stbillspatccf22<span class="w"> </span><span class="se">\</span>

<span class="w"> </span>--azure-file-volume-share-name<span class="w"> </span>ccf22billspat<span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--azure-file-volume-account-key<span class="w"> </span>dve+w+fw8XUSLE91pKO2i6.....etc....KV49ZHYEY07qsvBBpnPV9+AStjQ7vFg<span class="o">==</span><span class="w"> </span><span class="se">\</span>
<span class="w"> </span>--azure-file-volume-mount-path<span class="w"> </span>/home/jovyan/notebooks
</code></pre></div>
<p>The web address for the Juypter lab server, after looking up the security Token using the methods describe above is: </p>
<p><code>jupyterlab-test.northcentralus.azurecontainer.io:8888/lab?token=7e0ef407a591f10cfb358850c25cdc6529742309366382f0</code></p>
<p>note that if you use Azure Blob storage, you can read/write to it using Python commands without having to connect when you build the container.  You need the connection string and to have the Azure python packages installed (see below for inforemation on how to modify the datascience-notebook image to install more python packages)</p>
<p><strong>Creating containers using the Azure Portal</strong></p>
<p>The portal has nice forms for creating container instances, but you will still need the three storage account information as described above.  </p>
<h3 id="managing-containers-in-azure">Managing Containers in Azure</h3>
<p>If you stop the instance you are no longer charged.  You can start/stop from the command line or from the portal</p>
<div class="highlight"><pre><span></span><code>az<span class="w"> </span>container<span class="w"> </span>stop<span class="w"> </span>--resource-group<span class="w"> </span>ccf22_billspat<span class="w"> </span>--name<span class="w"> </span>jupyterlab-test
<span class="c1"># later...</span>
az<span class="w"> </span>container<span class="w"> </span>start<span class="w"> </span>--resource-group<span class="w"> </span>ccf22_billspat<span class="w"> </span>--name<span class="w"> </span>jupyterlab-test
<span class="c1"># this does take a while, but may be easier than recreating it.  </span>
</code></pre></div>
<p>However to keep your Resource group tidy, if you are finished with a container instannce for a while you should delete it. </p>
<p><code>az container delete --resource-group ccf22_billspat --name jupyterlab-test</code></p>
<h3 id="azure-container-instance-alternate-method">Azure Container Instance Alternate Method</h3>
<p>There are several ways to do this - of course there are, this is Microsoft!   </p>
<p>Microsoft worked with the Docker company to get commands built into the <code>docker</code> utility to be able to run docker files via your laptop.    In Docker-world, a 'context' is how the container is run, which could be different folders on  your laptop, some kind of fancy docker server, or a cloud service. </p>
<p>The following are pretty clear instructions for using the Docker 'context' for connection to Azure container instance (ACI) and when you <code>docker run</code> the container will load on Azure instead of your laptop.  It's not clear to me exactly which is a better method, however with this method you get all the options available to you via the docker run command, except mounting a volume from your laptop of course.  </p>
<p><a href="https://devblogs.microsoft.com/devops/publishing-azure-container-instances-from-docker-cli/">https://devblogs.microsoft.com/devops/publishing-azure-container-instances-from-docker-cli/</a></p>
<h3 id="yet-another-method-for-docker-containers-from-microsoft-visual-studio-code">Yet another method for Docker Containers from Microsoft : Visual Studio Code</h3>
<p>If you are a Visual Studio Code user, there is a Docker plugin for editing Dockerfiles and running them on Azure : <a href="https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-docker">https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-docker</a></p>
<p>I have not tested this but if it may be useful for debugging a complex Dockerfile. </p>
<h2 id="part-iii-diy">Part III.  DIY!</h2>
<p>While you may find a ready made Docker image that has all you need, chances are you'll need to modify it for your own work, and that means making your own images.   </p>
<ol>
<li>Select a Base Image.  We always start with an existing image.  Could be a very basic version of Linux that we install everything into, or an existing full image that we just add a little to. </li>
<li>Write a Dockerfile : instructions for adding things to the base image (install software, configuration, copying code or data)</li>
<li>Build: from the Dockerfile create an image.  <ul>
<li>on your own computer using the Docker software</li>
<li>on a remote repository, like Azure which lets you build on their system</li>
</ul>
</li>
<li>Option: upload to a remote repository to be able to pull the image from other places</li>
<li>Run: run to create a container from the image<ul>
<li>the image you just built on your computer, or</li>
<li>from the remote repository you just uploaed to (see optional step above) (e.g pull from remote and run)</li>
</ul>
</li>
</ol>
<p>There is documentation from Docker about what does into a dockerfile, but I find that confusing as they talk about each command, but not how the commands go together.  There are many tutorials for building Dockerfiles to run websites, but not many (if any) for researchers!  </p>
<p>We've been using Docker images from Jupyter-Stacks.  Here is their example Dockerfile that installs python packages on to their base image: <a href="https://github.com/jupyter/docker-stacks/blob/main/scipy-notebook/Dockerfile">https://github.com/jupyter/docker-stacks/blob/main/scipy-notebook/Dockerfile</a>    This is a bit complex example but it has many of the ingredients of a standard Dockerfile. </p>
<p>Main sections: </p>
<ul>
<li><strong>FROM</strong> always start with a base container.  They </li>
<li><strong>ARGS</strong> set variables to re-use later in the file.  This makes it easy to change in just one place</li>
<li><strong>RUN</strong> run a linux command in the base container to install something, or set configuration.  Note that most of these try to bundle as many commands as possible into on <code>RUN</code> to save space, and hence use the "Line continuation" character to make the command readable.  In the linux shell is usually the back slash or <code>\</code>  - when you see that it means continue on the next line for this command.  You will also see <code>&amp;&amp;</code> operator which says keep going and run the next command.   These two things allow for very very long commands to run at once (and make the container smaller)</li>
<li><strong>COPY</strong> copy something from your computer into the container : data, code, configuration files, etc</li>
</ul>
<p>This example uses the example Notebook file you downloaded for Part 1 above, but let's download it again.  </p>
<p>The datascience Jupyter is great, but what if you want to do Natural Language analysis?  We need the [NLTK] package for that, along with the data file for stop words.   Let's create new container that starts with the Jupyter Stacks data science image, and adds those things.   </p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">jupyter/datascience-notebook:latest</span>
<span class="k">RUN</span><span class="w">  </span>pip<span class="w"> </span>install<span class="w"> </span>nltk<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;from nltk import download; download(&quot;stopwords&quot;)&#39;</span>
</code></pre></div>
<p>To build a new image called "jupyter_nltk", save this as a file called "Dockerfile" in a folder by itself and run </p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span><span class="s2">&quot;folder where yuor docker file is&quot;</span>
docker<span class="w"> </span>build<span class="w"> </span>-t<span class="w"> </span>jupyter_nltk:latest<span class="w"> </span>-f<span class="w"> </span>Dockerfile<span class="w"> </span>.
</code></pre></div>
<p>Note the command has a period / dot at the end and that's required if the docker file is in the directory from which your run the command</p>
<p>To run this new container, use this command.  Notice that since this Image is on your </p>
<p>let's say you also wanted to copy a notebook file called "example.ipynb" from the same directory that the docker  into this container for demonstration.   You could do this: </p>
<div class="highlight"><pre><span></span><code><span class="k">FROM</span><span class="w"> </span><span class="s">jupyter/datascience-notebook:latest</span>
<span class="k">RUN</span><span class="w">  </span>pip<span class="w"> </span>install<span class="w"> </span>nltk<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>python<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;from nltk import download; download(&quot;stopwords&quot;)&#39;</span>
<span class="k">COPY</span><span class="w"> </span>example.ipynb<span class="w"> </span><span class="nv">$HOME</span>
</code></pre></div>
<h3 id="part-iii-bonusdiy-containers-in-azure">Part III Bonus:DIY containers in Azure</h3>
<p>This is the culmination of all of knowledge above, and actually what researchers most likely need to do:  run a container that they have created in the cloud </p>
<p>The key concept here is a container registry, which contains "repositories" which are history and versions of container images.  A registry is a web application to build and store Docker images.   Dockerhub is the most widely used container repository and you could use that, but with Azure you can make your own private registry. </p>
<p>Here are instructions for using Dockerhub: <a href="https://www.docker.com/blog/how-to-build-and-test-your-docker-images-in-the-cloud-with-docker-hub/">https://www.docker.com/blog/how-to-build-and-test-your-docker-images-in-the-cloud-with-docker-hub/</a> . Dockerhub is a great option if you want to share your images with others (at no cost to you!).  However We will be using Azure since we are running a container on Azure.   </p>
<p>A note about terminology:   A "registry" is a service that can hold many images.  Each image has versions (e.g. tags, latest, v1, v2, v2022, etc), and so this is called a "repository"</p>
<p>you create your own registry/repository that is private just to you (and or your lab or workgroup).   There is a fee for this but it's not much.   The advantage to Azure Container registries is you can keep them private, and you can create the repository and build images with the <code>az</code> comnmand line (or the protal as usual)</p>
<p>see <a href="https://learn.microsoft.com/en-us/cli/azure/acr?view=azure-cli-latest">https://learn.microsoft.com/en-us/cli/azure/acr?view=azure-cli-latest</a> about the ACR service.  </p>
<p>Microsoft also has a tutorial for creating an Azure Container Registry using a container image from their own public registry <a href="https://learn.microsoft.com/en-us/azure/container-registry/container-registry-quickstart-task-cli">https://learn.microsoft.com/en-us/azure/container-registry/container-registry-quickstart-task-cli</a> that is pretty good.  However the steps below build upon the Dockerfile created above. </p>
<p><strong>1. Create a registry to hold your images</strong></p>
<p>Create an ACR (azure container repository)/ with the command line (replace ACR name and resource group name to match yours ): </p>
<p><code>az acr create -n &lt;UNIQUEREGISTRYNAME&gt; -g RESOURCEGROUPNAME --sku Standard</code></p>
<p><strong>2. then use that ACR to build the Docker image from your local Dockerfile.</strong>   </p>
<p>First, use <code>cd</code> to change to the directory with your dockerfile in it with <code>cd /path/to/my/Docker/folder</code></p>
<p>Assuming there is a Dockerfile in the current directory (e.g. if your terminal is in the same folder as the Dockerfile above)</p>
<p><code>az acr build -t jupyter-nltk:latest --file Dockerfile --registry UNIQUEREGISTRYNAME .</code></p>
<p>Command ends with a single "dot" indicating we are using the Dockerfile that is present in this folder.  </p>
<p><strong>3. Run the container on ACI from the ACR</strong></p>
<p>Once built, you can create containers from this image.   By default any Container registry you created in Azure is private (unlike the public Dockerhub).   So when you want to use image that's hosted in a private Azure container registry like the one created above, you must supply credentials to access the registry.</p>
<p>get the  full name of the container registry login server using the command line (or the Portal):</p>
<p><code>az acr show --name &lt;UNIQUEREGISTRYNAME&gt; --query loginServer</code></p>
<p>(this does not have storage account mounted):</p>
<p>az container create --resource-group "ccf22_billspat" \
 --name jupyterlab-nltk --image jupyterlab-nltk:latest \
 --dns-name-label "jupyterlab-nltk" --ports 8888 </p>
<p>You can find the web address by visiting the portal, using <code>az container show</code> as described above, and you'll also need to the token from the logs, which is also described. </p>
<p>I put a collection of code  to combine the steps for this online: <a href="https://gist.github.com/psbills/5d42a55d53f0403ba5770b876dd74a3d">https://gist.github.com/psbills/5d42a55d53f0403ba5770b876dd74a3d</a></p>
<p>This should work on Mac, Linux, and the Azure Cloud shell.  (Not tested on Windows)</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections"], "search": "../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.94c44541.min.js"></script>
      
    
  </body>
</html>