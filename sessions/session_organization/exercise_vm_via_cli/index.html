
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.2.8">
    
    
      
        <title>Exercise vm via cli - 2022 MSU Cloud Computing Fellowship</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.046329b4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.85d0ee34.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cli-interface-tutorial-exercise" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="2022 MSU Cloud Computing Fellowship" class="md-header__button md-logo" aria-label="2022 MSU Cloud Computing Fellowship" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            2022 MSU Cloud Computing Fellowship
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Exercise vm via cli
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="2022 MSU Cloud Computing Fellowship" class="md-nav__button md-logo" aria-label="2022 MSU Cloud Computing Fellowship" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    2022 MSU Cloud Computing Fellowship
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022 Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Schedule
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../contact/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contact
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../about/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Fall 2022 Sessions
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Fall 2022 Sessions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../session_introduction/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1a. Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../session_how_to_cloud/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    1b. How to cloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../session_cloud_storage/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Cloud Storage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../session_datasystems/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. Data Systems
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../session_bigdata/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Big Data and the cloud
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../session_serverless/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. Serverless, Containers, and FaaS
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../session_organization/index.md" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bonus Cloud Services Organization
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../projects/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    About Fellowship Projects 2022-23
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../references/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    References
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../cloud_glossary/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cloud Glossary
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#cli-interface-tutorial-exercise" class="md-nav__link">
    CLI Interface Tutorial / Exercise
  </a>
  
    <nav class="md-nav" aria-label="CLI Interface Tutorial / Exercise">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#first-launch-azure-cloud-shell" class="md-nav__link">
    First, Launch Azure Cloud Shell
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#try-running-the-following-commands" class="md-nav__link">
    Try running the following commands
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#complete-example-commands-using-my-resource-group" class="md-nav__link">
    Complete example commands (using my resource group)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    References:
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Exercise vm via cli</h1>

<h2 id="cli-interface-tutorial-exercise">CLI Interface Tutorial / Exercise</h2>
<p><em>MSU Cloud Computing Fellowship, Pat Bills, IT Services</em></p>
<p>This tutorial walks through using the CLI with code you can copy, modify and try.   This will run in the Azure portal "cloud shell" if you have set it up to use the CLI interface (not the PowerShell interface)</p>
<p>You can refer to the original tutorial which is perhaps more clear, but doesn't quite fit our situation : <a href="https://learn.microsoft.com/en-us/azure/virtual-machines/linux/quick-create-cli">Quickstart: Create a Linux virtual machine with the Azure CLI</a></p>
<p>If you follow this - please don't delete your resource group!  </p>
<p>In the code below, lines that start with <code>#</code> are comments only, but the other lines are commands.  You can copy/paste one command at at time
into the CLI of the cloud shell.  Since these are long commands, a long command can be broken up using the line-continuation character which is the back-slash <code>\</code> so one command are all the lines until the last one that does not end with a back-slash</p>
<h3 id="first-launch-azure-cloud-shell">First, Launch Azure Cloud Shell</h3>
<p>The Azure Cloud Shell is a free interactive shell that you can use to run the steps in this article. It has common Azure tools preinstalled and configured to use with your account.</p>
<p>To open the Cloud Shell, just select Try it from the upper right corner of a code block. You can also open Cloud Shell in a separate browser tab by going to <a href="https://shell.azure.com/bash">https://shell.azure.com/bash</a>. Select Copy to copy the blocks of code, paste it into the Cloud Shell, and select Enter to run it.</p>
<h3 id="try-running-the-following-commands">Try running the following commands</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># create a VM and all of the items needed for it  : OS Disk, network security group, etc.  </span>
<span class="c1"># replace the names with your own group and other names.  </span>
<span class="c1"># Remember to change the group and VM name</span>

az<span class="w"> </span>vm<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--resource-group<span class="w"> </span>mygroupname<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span>mytestvm<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--image<span class="w"> </span>Debian<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--public-ip-sku<span class="w"> </span>Standard<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--admin-username<span class="w"> </span>azureuser<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--tags<span class="w"> </span><span class="s1">&#39;activity=cli_tutorial&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--generate-ssh-keys
</code></pre></div>
<p>Here is a real example command for my own resource group: </p>
<div class="highlight"><pre><span></span><code>az vm create \
 --resource-group ccf22_billspat \
 --name billspat-tutorial-vm \
 --image Debian \
 --public-ip-sku Standard
 --admin-username billspat \
 --tags &#39;activity=cli_tutorial&#39; \
 --generate-ssh-keys
</code></pre></div>
<p>The output will look something like this: </p>
<p><div class="highlight"><pre><span></span><code>{
  &quot;fqdns&quot;: &quot;&quot;,
  &quot;id&quot;: &quot;/subscriptions/047e742e-cb26-41e6-a9d6-9d42c67f43e6/resourceGroups/ccf22_billspat/providers/Microsoft.Compute/virtualMachines/billspat-tutorial-vm&quot;,
  &quot;location&quot;: &quot;northcentralus&quot;,
  &quot;macAddress&quot;: &quot;00-22-48-8F-48-C2&quot;,
  &quot;powerState&quot;: &quot;VM running&quot;,
  &quot;privateIpAddress&quot;: &quot;10.4.0.5&quot;,
  &quot;publicIpAddress&quot;: &quot;20.236.78.140&quot;,
  &quot;resourceGroup&quot;: &quot;ccf22_billspat&quot;,
  &quot;zones&quot;: &quot;&quot;
}
</code></pre></div>
Copy and paste that somewhere for reference last. </p>
<p><strong>Now give that VM a purpose and install a web server</strong>.  There are many webserver that you can install, but nginx is easy to install and open source.  You can do this in two ways</p>
<p>1) use the CLI to run a command on the VM directly
<div class="highlight"><pre><span></span><code>az vm run-command invoke \
   --resource-group mygroupname \
   --name mytestvm \
   --command-id RunShellScript \
   --scripts &quot;sudo apt-get update &amp;&amp; sudo apt-get install -y nginx&quot;
</code></pre></div></p>
<p>2) use SSH to connect to the VM and run it directly.  that will be for another tutorial! </p>
<p>The output from the command above will be something like</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">  </span><span class="nt">&quot;value&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">      </span><span class="nt">&quot;code&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ProvisioningState/succeeded&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;displayStatus&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Provisioning succeeded&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;level&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Info&quot;</span><span class="p">,</span>
<span class="w">      </span><span class="nt">&quot;message&quot;</span><span class="p">:</span><span class="w"> </span><span class="err">&quot;Enable succeeded: \n[stdout]\ne libnginx-mod-http-xslt-filter.\r\nPreparing to unpack .../23-libnginx-mod-http-xslt-filter_1.14.2-2+deb10u4_amd64.deb ...\r\nUnpacking libnginx-mod-http-xslt-filter (1.14.2-2+deb10u4) ...\r\nSelecting previously unselected package libnginx-mod-mail.\r\nPreparing to unpack .../24-libnginx-mod-mail_1.14.2-2+deb10u4_amd64.deb ...\r\nUnpacking libnginx-mod-mail (1.14.2-2+deb10u4) ...\r\nSelect  etc</span>
</code></pre></div>
<p><strong>Open port 80 for web traffic</strong></p>
<p>By default, only SSH connections are opened when you create a Linux VM in Azure. Use az vm open-port to open TCP port 80 for use with the NGINX web server:</p>
<div class="highlight"><pre><span></span><code>az<span class="w"> </span>vm<span class="w"> </span>open-port<span class="w"> </span>--port<span class="w"> </span><span class="m">80</span><span class="w"> </span>--resource-group<span class="w"> </span>mygroupname<span class="w"> </span>--name<span class="w"> </span>mytestvm
</code></pre></div>
<p><strong>check that it's working</strong></p>
<p>Put the IP address from the output above (or use the portal to find it) into your browser to see if you can connect,. If so, then great!  you've just built a web server.   </p>
<p><strong>Delete everything</strong></p>
<p>You can't delete your how resource group, but luckily we used tags to create the VM so we can just delete resource by tag. </p>
<p>You can use the portal to delete these resources, but if here are commands to do it with the CLI.  You can delete things by name, like this</p>
<div class="highlight"><pre><span></span><code><span class="w"> </span>az<span class="w"> </span>vm<span class="w"> </span>delete<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--resource-group<span class="w"> </span>mygroup<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span>myvm
</code></pre></div>
<p>but every resource has a unique ID, and can be deteled using that ID with the command 
<code>az resource delete --ids IDVALUE</code>   You can get those IDs using <code>az resource list...</code></p>
<div class="highlight"><pre><span></span><code><span class="c1"># list all resources just created  (change the tag to match what you used if necessary)</span>
az<span class="w"> </span>resource<span class="w"> </span>list<span class="w"> </span>--tag<span class="w"> </span><span class="nv">activity</span><span class="o">=</span>cli_tutorial

<span class="c1"># The CLI can filter and change the format of it&#39;s output</span>
<span class="c1"># list ONLY the resource IDs using the &quot;query&quot; and tabular output</span>
az<span class="w"> </span>resource<span class="w"> </span>list<span class="w"> </span>--tag<span class="w"> </span><span class="nv">activity</span><span class="o">=</span>cli_tutorial<span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;[].id&quot;</span><span class="w"> </span>-o<span class="w"> </span>table

<span class="c1"># delete them all using a shell loop (tsv does not output a header line)</span>
<span class="nv">IDS</span><span class="o">=</span><span class="k">$(</span>az<span class="w"> </span>resource<span class="w"> </span>list<span class="w"> </span>--tag<span class="w"> </span><span class="nv">activity</span><span class="o">=</span>cli_tutorial<span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;[].id&quot;</span><span class="w"> </span>-o<span class="w"> </span>tsv<span class="k">)</span>
<span class="k">for</span><span class="w"> </span>id<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$IDS</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>az<span class="w"> </span>resource<span class="w"> </span>delete<span class="w"> </span>--ids<span class="w"> </span><span class="nv">$id</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
</code></pre></div>
<h3 id="complete-example-commands-using-my-resource-group">Complete example commands (using my resource group)</h3>
<div class="highlight"><pre><span></span><code>az<span class="w"> </span>vm<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--resource-group<span class="w"> </span>ccf22_billspat<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span>billspat-tutorial-vm<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--image<span class="w"> </span>Debian<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--public-ip-sku<span class="w"> </span>Standard<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--admin-username<span class="w"> </span>billspat<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--tags<span class="w"> </span><span class="s1">&#39;activity=cli_tutorial&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--generate-ssh-keys

<span class="c1"># copy and paste the output of that</span>

az<span class="w"> </span>vm<span class="w"> </span>run-command<span class="w"> </span>invoke<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>--resource-group<span class="w"> </span>ccf22_billspat<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>--name<span class="w"> </span>billspat-tutorial-vm<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>--command-id<span class="w"> </span>RunShellScript<span class="w"> </span><span class="se">\</span>
<span class="w">   </span>--scripts<span class="w"> </span><span class="s2">&quot;sudo apt-get update &amp;&amp; sudo apt-get install -y nginx&quot;</span>

az<span class="w"> </span>vm<span class="w"> </span>open-port<span class="w"> </span>--port<span class="w"> </span><span class="m">80</span><span class="w"> </span>--resource-group<span class="w"> </span>ccf22_billspat<span class="w"> </span>--name<span class="w"> </span>billspat-tutorial-vm

<span class="c1"># list all resources just created </span>
az<span class="w"> </span>resource<span class="w"> </span>list<span class="w"> </span>--tag<span class="w"> </span><span class="nv">activity</span><span class="o">=</span>cli_tutorial

<span class="c1"># list ONLY the resource IDs using the &quot;query&quot; and tabular output</span>
az<span class="w"> </span>resource<span class="w"> </span>list<span class="w"> </span>--tag<span class="w"> </span><span class="nv">activity</span><span class="o">=</span>cli_tutorial<span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;[].id&quot;</span><span class="w"> </span>-o<span class="w"> </span>table

<span class="c1"># delete them all using a shell loop (tsv does not output a header line)</span>
<span class="nv">IDS</span><span class="o">=</span><span class="k">$(</span>az<span class="w"> </span>resource<span class="w"> </span>list<span class="w"> </span>--tag<span class="w"> </span><span class="nv">activity</span><span class="o">=</span>cli_tutorial<span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;[].id&quot;</span><span class="w"> </span>-o<span class="w"> </span>tsv<span class="k">)</span>
<span class="k">for</span><span class="w"> </span>id<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="nv">$IDS</span><span class="p">;</span><span class="w"> </span><span class="k">do</span><span class="w"> </span>az<span class="w"> </span>resource<span class="w"> </span>delete<span class="w"> </span>--ids<span class="w"> </span><span class="nv">$id</span><span class="p">;</span><span class="w"> </span><span class="k">done</span>
</code></pre></div>
<p><strong>bonus points</strong>: set shell variables for the resource group and name and use them in the commands.  For example </p>
<div class="highlight"><pre><span></span><code><span class="nv">RG</span><span class="o">=</span>ccf22_billspat
<span class="nv">VMNAME</span><span class="o">=</span>billspat-tutorial-vm
az<span class="w"> </span>vm<span class="w"> </span>create<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span><span class="nv">$VMNAME</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--image<span class="w"> </span>Debian<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--public-ip-sku<span class="w"> </span>Standard<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--admin-username<span class="w"> </span>billspat<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--tags<span class="w"> </span><span class="s1">&#39;activity=cli_tutorial&#39;</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--generate-ssh-keys

<span class="c1"># ... do other stuff, then delete</span>

<span class="w"> </span>az<span class="w"> </span>vm<span class="w"> </span>delete<span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--resource-group<span class="w"> </span><span class="nv">$RG</span><span class="w"> </span><span class="se">\</span>
<span class="w">  </span>--name<span class="w"> </span><span class="nv">$VMNAME</span>
</code></pre></div>
<h3 id="references">References:</h3>
<ul>
<li>Quickstart: Create a Linux virtual machine with the Azure CLI <a href="https://learn.microsoft.com/en-us/azure/virtual-machines/linux/quick-create-cli">https://learn.microsoft.com/en-us/azure/virtual-machines/linux/quick-create-cli</a></li>
<li>Azure Command-Line Interface (CLI) documentation <a href="https://learn.microsoft.com/en-us/cli/azure/">https://learn.microsoft.com/en-us/cli/azure/</a></li>
<li>All <code>az vm...</code> command options : <a href="https://learn.microsoft.com/en-us/cli/azure/vm?view=azure-cli-latest">https://learn.microsoft.com/en-us/cli/azure/vm?view=azure-cli-latest</a></li>
<li>Use tags to organize your Azure resources (with the Azure CLI)! <a href="https://techcommunity.microsoft.com/t5/azure/use-tags-to-organize-your-azure-resources-with-the-azure-cli/m-p/1798955">https://techcommunity.microsoft.com/t5/azure/use-tags-to-organize-your-azure-resources-with-the-azure-cli/m-p/1798955</a></li>
<li></li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.sections"], "search": "../../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.dff1b7c8.min.js"></script>
      
    
  </body>
</html>