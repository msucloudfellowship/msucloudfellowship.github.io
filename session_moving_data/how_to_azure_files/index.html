
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.2.4">
    
    
      
        <title>How to Use Azure Files with Windows and Linux VMs - MSU Cloud Fellowship</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.f7f47774.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#000000">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="black" data-md-color-accent="">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#how-to-use-azure-files-with-windows-and-linux-vms" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="MSU Cloud Fellowship" class="md-header__button md-logo" aria-label="MSU Cloud Fellowship" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MSU Cloud Fellowship
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              How to Use Azure Files with Windows and Linux VMs
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="MSU Cloud Fellowship" class="md-nav__button md-logo" aria-label="MSU Cloud Fellowship" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    MSU Cloud Fellowship
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../contact/" class="md-nav__link">
        Contact
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
      
      
      

  
  
  
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      <label class="md-nav__link" for="__nav_4">
        Sessions
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Sessions" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Sessions
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../session_introduction/" class="md-nav__link">
        1. Introduction
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../session_how_to_cloud/" class="md-nav__link">
        2. How does the cloud work?
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../session_cloud_storage/" class="md-nav__link">
        3. Cloud Storage
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        4. Moving Data
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../session_bigdata/" class="md-nav__link">
        5. Big Data and the cloud
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../session_datasystems/" class="md-nav__link">
        6. Cloud Data Systems
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../session_serverless/" class="md-nav__link">
        7. Serverless, Containers, and FaaS
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../references/" class="md-nav__link">
        References
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../cloud_glossary/" class="md-nav__link">
        Cloud Glossary
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    Summary
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#details" class="md-nav__link">
    Details
  </a>
  
    <nav class="md-nav" aria-label="Details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#using-file-shares-in-a-storage-account" class="md-nav__link">
    using  "File Shares" in a storage account
  </a>
  
    <nav class="md-nav" aria-label="using  "File Shares" in a storage account">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview-of-process-to-use-with-a-vm" class="md-nav__link">
    Overview of process to use with a VM
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connecting-file-share-to-windows-to-read-or-save-data" class="md-nav__link">
    Connecting File Share to Windows to read or save data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connecting-file-share-to-linux-to-read-andor-save-data" class="md-nav__link">
    Connecting File Share to Linux to read and/or save data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#performance-issues-with-using-file-shares-and-a-work-around" class="md-nav__link">
    Performance issues with using File Shares and a work-around
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="how-to-use-azure-files-with-windows-and-linux-vms">How to Use Azure Files with Windows and Linux VMs</h1>
<p>The Azure cloud storage session materials describes "Azure Files" as one of several types of storage available.   Here are some details about using Azure Files in practice to read and write data from a virtual machine </p>
<p>Please review the <a href="https://docs.microsoft.com/en-us/azure/storage/files/storage-files-introduction">Azure Documentation describing the "Azure Files" service</a>  </p>
<h2 id="summary">Summary</h2>
<p>The "Azure Files" (or File Shares) service is Microsoft's attempt to provide storage with an interface that many IT people are familiar with, but at Cloud scale.  They market it heavily as a replacement for File servers that an institution or company have to maintain.   The alternative is blog storage, which works well when you alter your program code to read and write to blob storage, and for users of existing software (e.g. GUI software for your scientific application) you can't change the code. </p>
<p>In practice, Azure File storage does work like cloud in that there are few limits on storage but you can also attach it as if it were network storage ("network attach") so you don't have to change your software.    However it is more expensive than Blob storage and it is slower than network storage, especially much slower than storage in an HPC environment. </p>
<p>So what to do?  One method I've used to take advantage of the convenience of Azure Files storage but I need speed, I'll copy those files that need to have fast access onto the local disk of the VM (or service), but still use Azure files to save files (write output).  </p>
<p>There are several ways to use Network Attach Storage, and they are named for the file sharing protocol.  A very common protocol invented by Microsoft in the 90s is Server Message Block or SMB.  You don't have to know how it works, just that Windows, Mac and Linux have SMB file connection software built-in.   Most on-premise network disk systems use SMB.  </p>
<h2 id="details">Details</h2>
<h3 id="using-file-shares-in-a-storage-account">using  "File Shares" in a storage account</h3>
<p>A storage account is the entry point in Azure to any kind of storage service ( see materials in the <a href="../session_cloud_storage">Cloud Storage session</a> ), so you need to first create a storage account.  You can use an existing storage account for any tutorials or quickstarts linked below (though many of them have you create a resource group and storage account in the tutorial, can skip that although you'll have to adjust the names used). </p>
<p>Note that storage account can have both blog storage containers and file shares in the same account.  </p>
<p>When you open a storage account resource in the portal, there is a "File Shares" option on the left-side menu which opens the form to add file shares to your storage account. </p>
<p>Follow this quick start to create a file share, which also walks through creating a storage account if you need one : </p>
<p><a href="https://docs.microsoft.com/en-us/azure/storage/files/storage-how-to-use-files-portal?tabs=azure-portal">https://docs.microsoft.com/en-us/azure/storage/files/storage-how-to-use-files-portal?tabs=azure-portal</a></p>
<h4 id="overview-of-process-to-use-with-a-vm">Overview of process to use with a VM</h4>
<ol>
<li>create a file share and upload your data using the Storage Explorer or other data movement method (e.g. Azure Data Factory, <code>azcopy</code> from your on-premise computer such as the HPC)</li>
<li>create a Virtual Machine.  since the data will stay on the File Share (but see below for performance) you may not need to provisions a VM disk much larger than 30gb</li>
<li>after the VM is started and you are logged in, see methods below for attaching File share</li>
<li>run your software but adjust the code or select folders on the connected file share (e.g. <code>D:\\</code> on windows or the mount path in linux)</li>
<li>save output the the cloud Storage File Share</li>
<li>when finished, close and delete the VM and associated resources</li>
<li>access output files using Storage Explorer, or another method</li>
</ol>
<p>See below for Azure instructions for each type of machine (Windows, Linux)</p>
<h3 id="connecting-file-share-to-windows-to-read-or-save-data">Connecting File Share to Windows to read or save data</h3>
<p>If you are using Windows to run your software, you may want to read/write data to a file share, so you can delete the Windows VM when you are finished with a session, but keep your results.    If you attach a file share to the windows VM, use that. </p>
<p>After creating a file share, you can connect that to a windows VM.  In session #2 we created a Windows VM based on the Data Science Virtual Machine image.  The following uses a different image (Windows Server) but the process is the same: </p>
<p><a href="https://docs.microsoft.com/en-us/azure/storage/files/storage-how-to-use-files-windows">Mount SMB Azure file share on Windows</a></p>
<!--- hide this for now, it may be too much 

Here is another method, which also discusses using 'snapshots' which is alllows you to create a backup in time of your data (so you could for example, try an experimental program which may corrupt your data, and always go back to the previous state of your data files)

[Quickstart: Create and manage Azure file shares with Windows virtual machines](https://docs.microsoft.com/en-us/azure/storage/files/storage-files-quick-create-use-windows)

-->

<h3 id="connecting-file-share-to-linux-to-read-andor-save-data">Connecting File Share to Linux to read and/or save data</h3>
<p>These command-line based intructions show how to install the necesssary software and create a connection to a file share using SMB.    Like the windows example, this would be a method for accessing data on in cloud storage so that you can remove </p>
<p>[Mount SMB Azure file share on Linux]<a href="https://docs.microsoft.com/en-us/azure/storage/files/storage-how-to-use-files-linux?tabs=smb311">https://docs.microsoft.com/en-us/azure/storage/files/storage-how-to-use-files-linux?tabs=smb311</a></p>
<h3 id="performance-issues-with-using-file-shares-and-a-work-around">Performance issues with using File Shares and a work-around</h3>
<p>File shares are not as fast as a virtual machine disk, and those are not as fast as a disk on your physcial computer, or even as fast as on-premise Network Attached storage.  If your process does a lot of reading/writing and needs to be faster, one solution is to 'stage' the data to the VM disk</p>
<ol>
<li>assuming you have file share storage and a new VM with a large enough disk to hold data</li>
<li>connect/mount the file share storage as describe above to the VM</li>
<li>before running your program, copy the input data from file share storage to the VM disk, (e.g. <code>C:\</code> for Windows or perhaps the homedir /mnt/home in linux ) Ensure you've created a large enough VM OS Disk to hold your data</li>
<li>run your software, selecting this folder</li>
<li>when the program/script is completed, copy the ooutput back to your file share</li>
<li>shutdown and delete the VM</li>
<li>access the output data from file share d</li>
</ol>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.709b4209.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.febc23d1.min.js"></script>
      
    
  </body>
</html>